datasource db {
    provider = "sqlite"
    url      = "file:../app.db"
}

generator client {
    provider    = "cargo prisma"
    output      = "../src/prisma.rs"
    module_path = "crate::db"
}

model Company {
    id        Int        @id @default(autoincrement())
    name      String
    documents Document[]
    templates Template[]
    clients   Client[]
    settings  Settings?

    cin   String  @unique // IČO
    vatId String? @unique // DIČ

    // Adress
    address String
    city    String
    zip     String

    // Additional fields
    phone String?
    email String?
    web   String?

    // Bank account
    bankAccount String?
    bankCode    String?
    bankName    String?
    bankIBAN    String?

    // Document counter and info
    invoicePrefix  String @default("I")
    invoiceCounter Int    @default(1)

    proformaPrefix  String @default("P")
    proformaCounter Int    @default(1)

    recievePrefix  String @default("R")
    recieveCounter Int    @default(1)
}

model Client {
    id         Int    @id @default(autoincrement())
    clientType String @default("BOTH") // ENUM = SUPPLIER, CUSTOMER, BOTH

    name  String
    cin   String  @unique // IČO
    vatId String?

    address String
    city    String
    zip     String

    //Contact info
    email String?
    phone String?

    documents Document[]

    company   Company @relation(fields: [companyId], references: [id])
    companyId Int
}

model Document {
    id           Int    @id @default(autoincrement())
    number       String @unique
    documentType String // ENUM = INVOICE, PROFORMA, RECIEVE

    client   Client @relation(fields: [clientId], references: [id])
    clientId Int

    template   Template @relation(fields: [templateId], references: [id])
    templateId Int

    currency String

    issueDate DateTime
    taxDate   DateTime // Datum zdanitelného plnění
    dueDate   DateTime

    status String         @default("DRAFT") // ENUM = DRAFT, PENDING, PAID, CANCELLED, OVERDUE
    items  DocumentItem[]

    company   Company @relation(fields: [companyId], references: [id])
    companyId Int
}

model Template {
    id Int @id @default(autoincrement())

    name         String
    html         String
    templateType String     @default("INVOICE") // ENUM = INVOICE, CREDIT_NOTE todo!
    documents    Document[]

    company   Company @relation(fields: [companyId], references: [id])
    companyId Int
}

model DocumentItem {
    id Int @id @default(autoincrement())

    document   Document @relation(fields: [documentId], references: [id])
    documentId Int

    description String
    quantity    Int
    price       Float
    tax         Float
}

model Settings {
    id Int @id @default(autoincrement())

    company   Company @relation(fields: [companyId], references: [id])
    companyId Int     @unique

    currency String
    tax      Float
}
